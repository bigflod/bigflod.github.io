<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="robots" content="noindex, follow">
<title>Resultados de búsqueda</title>

<script src="https://unpkg.com/lunr/lunr.js"></script>

<style>
:root {
  --bg: #ffffff;
  --surface: #f7f7f9;
  --border: #e5e7eb;
  --text: #1f2937;
  --muted: #6b7280;
  --accent: #3b82f6;
  --accent-soft: rgba(59,130,246,.08);
  --radius: 14px;
  --shadow: 0 10px 30px rgba(0,0,0,.06);
  --topHeader-h: 64px;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: linear-gradient(180deg, #f8fafc, #ffffff);
  color: var(--text);
  min-height: 100vh;
}

/* layout */
main {
  max-width: 900px;
  margin: 0 auto;
  padding: clamp(1.5rem, 4vw, 3rem);
}

h1 {
  font-size: clamp(1.6rem, 3vw, 2.2rem);
  margin-bottom: 1.5rem;
  letter-spacing: -0.02em;
}

/* results list */
.search-results {
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  gap: 1rem;
}

/* result card */
.result {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
}

.result:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 40px rgba(0,0,0,.1);
  border-color: var(--accent);
}

/* clickable block */
.result a {
  display: block;
  padding: 1.2rem 1.4rem;
  text-decoration: none;
  color: inherit;
}

/* title */
.result strong {
  display: block;
  font-size: 1.05rem;
  margin-bottom: .4rem;
  color: var(--accent);
}

/* summary */
.summary {
  display: block;
  font-size: .95rem;
  line-height: 1.5;
  color: var(--muted);
}

/* empty / error states */
.no-results {
  padding: 2rem;
  text-align: center;
  border-radius: var(--radius);
  background: var(--surface);
  border: 1px dashed var(--border);
  color: var(--muted);
  font-size: 1rem;
}

/* subtle highlight animation on load */
.result {
  animation: fadeUp .35s ease both;
}

@keyframes fadeUp {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* responsive tweaks */
@media (max-width: 600px) {
  .result a {
    padding: 1rem;
  }
  .summary {
    font-size: .9rem;
  }
}

/* Use shared stylesheet for header + base layout */
</style>
<link rel="stylesheet" href="css/styles.css">
<style>

/* Header inner container to align search input with main content */
.header-inner { max-width: 900px; margin: 0 auto; width: 100%; padding: 0 clamp(1.5rem, 4vw, 3rem); display:flex; align-items:center; }
#topHeader { position: fixed; top: 0; left: 0; right: 0; z-index: 4000; }
#searchContainerTop { width:100%; display:flex; align-items:center; gap:0.6rem; }
#topSearchInput { flex:1; width:100%; padding:0.75rem 1rem; border-radius:28px; border:2px solid var(--search-accent); font-size:1.05rem; background:transparent; }
#topSearchInput:focus { outline:none; box-shadow: 0 6px 18px rgba(59,130,246,0.08); }

/* push main content down so header doesn't overlap */
main { padding-top: calc(var(--topHeader-h) + 1rem); }
</style>
</head>

<body>

  <div id="overlay"></div>

  <div class="side-menu" id="sideMenu">
      <h3>Menú</h3>
      <a href="/es/">Inicio</a>
      <a href="/tutoriales/">Tutoriales</a>
      <a href="/cursos/">Cursos</a>
      <a href="/blog/">Blog</a>
      <!-- Example topic / subtopic entries -->
        <!-- TOPIC 1 -->
      <a href="/algoritmos/" class="topic">Introducción a Algoritmos</a>
      <a href="/algoritmos/definicion" class="subtopic">Definición</a>
      <a href="/algoritmos/propiedades" class="subtopic">Propiedades</a>
      <a href="/algoritmos/ejemplos" class="subtopic">Ejemplos básicos</a>

      <!-- TOPIC 2 -->
      <a href="/estructuras-de-datos/" class="topic">Estructuras de Datos</a>
      <a href="/estructuras-de-datos/arreglos" class="subtopic">Arreglos</a>
      <a href="/estructuras-de-datos/listas-enlazadas" class="subtopic">Listas Enlazadas</a>
      <a href="/estructuras-de-datos/pilas-colas" class="subtopic">Pilas y Colas</a>
      <a href="/estructuras-de-datos/sets" class="subtopic">Conjuntos (Sets)</a>

      <!-- TOPIC 3 -->
      <a href="/ordenamiento/" class="topic">Algoritmos de Ordenamiento</a>
      <a href="/ordenamiento/burbuja" class="subtopic">Ordenamiento Burbuja</a>
      <a href="/ordenamiento/seleccion" class="subtopic">Ordenamiento por Selección</a>
      <a href="/ordenamiento/insercion" class="subtopic">Ordenamiento por Inserción</a>
      <a href="/ordenamiento/rapido-quick" class="subtopic">QuickSort</a>
      <a href="/ordenamiento/merge" class="subtopic">MergeSort</a>

      <!-- TOPIC 4 -->
      <a href="/recursion/" class="topic">Recursión</a>
      <a href="/recursion/concepto" class="subtopic">Concepto de Recursión</a>
      <a href="/recursion/caso-base" class="subtopic">Caso Base</a>
      <a href="/recursion/ejemplos" class="subtopic">Ejemplos Recursivos</a>

      <!-- TOPIC 5 -->
      <a href="/complejidad/" class="topic">Complejidad Algorítmica</a>
      <a href="/complejidad/tiempo" class="subtopic">Complejidad en Tiempo</a>
      <a href="/complejidad/espacio" class="subtopic">Complejidad en Espacio</a>
      <a href="/complejidad/big-o" class="subtopic">Notación Big-O</a>

      <!-- TOPIC 6 -->
      <a href="/busquedas/" class="topic">Algoritmos de Búsqueda</a>
      <a href="/busquedas/lineal" class="subtopic">Búsqueda Lineal</a>
      <a href="/busquedas/binary" class="subtopic">Búsqueda Binaria</a>
      <a href="/busquedas/hash" class="subtopic">Tablas Hash</a>

      <!-- TOPIC 7 -->
      <a href="/grafo/" class="topic">Grafos</a>
      <a href="/grafo/definicion" class="subtopic">Definición</a>
      <a href="/grafo/bfs-dfs" class="subtopic">BFS / DFS</a>
      <a href="/grafo/dijkstra" class="subtopic">Dijkstra</a>
      <a href="/grafo/kruskal" class="subtopic">Kruskal</a>

      <!-- TOPIC 8 -->
      <a href="/programacion-dinamica/" class="topic">Programación Dinámica</a>
      <a href="/programacion-dinamica/subproblemas" class="subtopic">Subproblemas</a>
      <a href="/programacion-dinamica/memoization" class="subtopic">Memoización</a>
      <a href="/programacion-dinamica/tabulacion" class="subtopic">Tabulación</a>


  </div>

  <header id="topHeader">
    <div id="searchContainerTop">
      <a href="/" class="search-logo-top" aria-label="Inicio"><img src="assets/logo.svg" alt="Logo" class="site-logo"></a>
      <input id="topSearchInput" class="search-input" type="text" placeholder="Buscar...">
      <button id="themeBtn" class="theme-btn-top" aria-label="Cambiar tema">
        <img id="themeIcon" src="assets/moon-icon.svg" alt="Tema">
      </button>
      <div class="search-icon"></div>
    </div>

    <nav class="top-links">
      <a href="/tutoriales/">Tutoriales</a>
      <a href="/ejercicios/">Ejercicios</a>
      <a href="/cursos/">Cursos</a>

      <button class="hamburger" id="hamburger" aria-label="Abrir menú" aria-expanded="false">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </button>
    </nav>
  </header>

  <script src="js/app.js"></script>

<main>
  <h1>Resultados de búsqueda</h1>
  <ul id="results" class="search-results"></ul>
</main>

<script>
  // --- Configuración ---
  const PAGES_JSON = '/assets/data/pages.json';

  const STOPWORDS = [
    'a','al','algo','algunas','algunos','ante','antes','como','con','contra','cualquier',
    'de','del','desde','donde','durante','e','el','ella','ellas','ellos','en','entre',
    'era','erais','éramos','es','esa','esas','ese','esos','esta','estaba','estabais','estábamos',
    'están','este','esto','estos','etc','ha','hace','haces','hago','hasta','incluso',
    'la','las','le','les','lo','los','más','me','mi','mis','muy','ni','no','nos','nosotros','o',
    'por','para','pero','que','qué','quien','si','sí','sin','sobre','su','sus','también','tanto',
    'te','tu','tus','un','una','uno','unos','y','ya'
  ];

  function tokenize(text) {
    if (!text) return [];
    return text
      .toString()
      .toLowerCase()
      .replace(/[\u00A0\u2000-\u206F\s]+/g, ' ')
      .replace(/[^a-z0-9áéíóúñç ]+/g, ' ')
      .split(/\s+/)
      .map(t => t.trim())
      .filter(Boolean);
  }

  function removeStopwords(tokens) {
    return tokens.filter(t => !STOPWORDS.includes(t));
  }

  const urlParams = new URLSearchParams(window.location.search);
  const rawQuery = urlParams.get('q') || '';
  const query = rawQuery.trim();

  // --- Prefill top search input (keep only what is page-specific) ---
  const topInput = document.getElementById('topSearchInput');
  if (topInput) {
    topInput.value = rawQuery || '';
    topInput.addEventListener('focus', () => {
      const len = topInput.value.length;
      try { topInput.setSelectionRange(len, len); } catch (e) {}
    });
    // clicking places caret at end
    topInput.addEventListener('click', () => { const len = topInput.value.length; try { topInput.setSelectionRange(len, len); } catch (e) {} });
  }

  const resultsContainer = document.getElementById('results');

  if (!query) {
    resultsContainer.innerHTML = '<li class="no-results">Introduce un término de búsqueda</li>';
  } else {
    fetch(PAGES_JSON)
      .then(r => r.json())
      .then(documents => {
        let idx = null;

        try {
          const cached = localStorage.getItem('lunr_index_v1');
          const cachedDocsCount = Number(localStorage.getItem('lunr_docs_count_v1') || '0');
          if (cached && cachedDocsCount === documents.length) {
            idx = lunr.Index.load(JSON.parse(cached));
          }
        } catch {}

        if (!idx) {
          idx = lunr(function() {
            try { this.pipeline.remove(lunr.stopWordFilter); } catch {}
            try { this.pipeline.add(lunr.generateStopWordFilter(STOPWORDS)); } catch {}

            this.ref('url');
            this.field('keywords', { boost: 10 });

            documents.forEach(doc => {
              this.add({
                url: doc.url,
                keywords: (doc.keywords || '').toString()
              });
            });
          });

          try {
            localStorage.setItem('lunr_index_v1', JSON.stringify(idx));
            localStorage.setItem('lunr_docs_count_v1', documents.length);
          } catch {}
        }

        const tokens = removeStopwords(tokenize(query));
        if (!tokens.length) {
          resultsContainer.innerHTML = '<li class="no-results">La búsqueda contiene solo palabras vacías.</li>';
          return;
        }

        const results = idx.search(tokens.join(' '));
        const docsByUrl = Object.fromEntries(documents.map(d => [d.url, d]));

        if (!results.length) {
          resultsContainer.innerHTML = '<li class="no-results">No se encontraron resultados</li>';
          return;
        }

        const frag = document.createDocumentFragment();
        results.forEach(r => {
          const d = docsByUrl[r.ref];
          const li = document.createElement('li');
          li.className = 'result';
          li.innerHTML = `
            <a href="${d.url}">
              <strong>${escapeHtml(d.title || d.url)}</strong>
              <span class="summary">${d.summary || ''}</span>
            </a>`;
          frag.appendChild(li);
        });

        resultsContainer.appendChild(frag);
      })
      .catch(() => {
        resultsContainer.innerHTML = '<li class="no-results">Error cargando datos de búsqueda.</li>';
      });
  }

  function escapeHtml(s) {
    return String(s)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;');
  }
</script>

</body>
</html>
